#!/bin/bash

set -euo pipefail
unset GIT_DIR GIT_WORK_TREE

# Prompt for and remember password
echo "Prompting for sudo password"
sudo --validate
while true; do
    sudo -n true
    sleep 60
    kill -0 "$$" || exit
done &>/dev/null &

# Install brew (to install git, which yadm needs)
if ! command -v brew &>/dev/null; then
    echo "Installing Homebrew"
    NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install yadm and run bootstrap
echo "Bootstrapping dotfiles"
source /dev/stdin <<<"$(curl -fsSL bootstrap.yadm.io)"
yadm clone --bootstrap https://github.com/branchvincent/dotfiles.git -f
